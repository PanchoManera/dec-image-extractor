BNE	IMSG3
	RTS	PC
19$:	JMP	OLOAD
.DSABL	LSB
FTEMP:	.WORD	0
MAPIT:	MOV	#$SLOT+3,R3
 OINST	MOV	.$UNAM,R1,*
1$:	DEC	R3
	BEQ	2$
	CMP	@R2,(R1)+
	BNE	1$
	MOV	$UNAM1-$UNAM2-2(R1),@R2
2$:	RTS	PC
.IF NE	UNLO$$
.SBTTL	UNLOAD
.ENABL	LSB
UNLDIN:
.IF NE	SYT$K
	MOV	R5,(PC)+
ERPTR:	 .WORD	0
	DEC	ERPTR
	JSR	PC,CKLJN
	BNE	16$
.ENDC
	OADDR	DEVSTS,R2
	OJSR	PC,GETNAM
	BEQ	14$
	OJSR	PC,OPTCOL
	MOV	R2,R0
 OINST	MOV	@R0,INPFN,,*
	MOV	R5,-(SP)
.IF NE	SYT$K
	CMPB	1(R5),#':
	BEQ	20$
	MOV	R5,R3
	MOV	ERPTR,R5
	JMP	NOSJB
20$:
.ENDC
	MOV	@#SYSPTR,R5
.IF NE	BF
.IF EQ	SYT$K
	MOV	SP,(PC)+
FGRUN:	 .WORD	0
	MOV	FCNTXT-$RMON(R5),R4
	BEQ	1$
	MOV	I.BLOK(R4),FGRUN
	BIC	#^C<NORUN$>,FGRUN
1$:	CMP	@R2,#<^RF  >
	BNE	2$
	TST	FGRUN
	BEQ	FJERR
	TST	R4
	BNE	16$
NOFERR:	KMEROR	<No foreground job>
FJERR:	KMEROR	<Foreground active>
.ENDC
.ENDC
2$:	JSR	PC,MAPIT
 OINST	MOV	@R2,INPFN,,*
	CMP	@R2,#<^RBA >
	BNE	4$
	CMP	LST16-$RMON(R5),#T$TIN-LST16
	BNE	15$
4$:	OJSR	R4,LK4DEV
	 BR	13$
	MOV	@R5,R4
	BEQ	11$
	CLR	R1
 OINST	MOV	.$ENTR,R0,*
5$:	CMP	R4,@R0
	BNE	7$
	MOV	SP,@<.EXTFL-OVLY>-<.+4-OVLYST>(PC)
.IF NE	BF
	MOV	R1,R3
 OINST	ADD	.$OWNE,R3,*
.IF EQ	SYT$K
	TST	FGRUN
	BNE	6$
	MOV	@R3,-(SP)
	BIS	2(R3),@SP
	BIT	#21042,(SP)+
	BNE	FJERR
.IFF
	JSR	PC,OWNRUN
.ENDC
6$:	CLR	(R3)+
	CLR	@R3
.ENDC
	CMP	@#SYSPTR,@R0
	BLOS	7$
	CLR	@R0
7$:	TST	(R0)+
	CMP	(R1)+,(R1)+
	CMP	R1,#$SLOT*4
	BLT	5$
	CMP	@#SYSPTR,R4
	BLOS	11$
	CMP	-(R4),-(R4)
	MOV	-(R4),R1
	BEQ	10$
	BPL	9$
	ASL	R1
	ADD	R4,R1
	TST	(R1)+
8$:	MOV	(R1)+,R5
	BEQ	10$
	JSR	PC,UNPRO
	CMP	(R1)+,(R1)+
	BR	8$
9$:	MOV	R1,R5
	JSR	PC,UNPRO
10$:	OJSR	PC,PUTBLK
	BCC	11$
	ADD	R0,@SP
	ADD	R0,2(SP)
11$:	MOV	(SP)+,R5
12$:	CLR	@<.EXTFL-OVLY>-<.+4-OVLYST>(PC)
	CMPB	@R5,#COMMA
	BEQ	UNLDIN
	TSTB	@R5
	BNE	14$
	RTS	PC
NOHAN:
13$:	OJMP	BADHAN
UNBCMD:
14$:	OJMP	BADCOM
15$:	KMEROR	<Must 'R BATCH', type '/U'>
.IF NE	BF
16$:	MOV	SP,@<.EXTFL-OVLY>-<.+4-OVLYST>(PC)
.IF EQ	SYT$K
	CLR	FCNTXT-$RMON(R5)
	BIC	#FJOB$,CONFIG-$RMON(R5)