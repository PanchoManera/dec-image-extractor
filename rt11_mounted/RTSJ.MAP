>
	SWTDEF	<BUFFER>
	FLGTXT		<B_UFFER>
	SWTDEF	<NAME>
	FLGTXT		<NA_ME>
	SWTDEF	<LEVEL>
	FLGTXT		<L_EVEL>
	.EVEN
	.ENABL	CRF
	NEXTL
.SBTTL	FRUN/SRUN (PART 2)
	OVERLAY
	OVCMD	FSRU2
.ENABL	LSB
 OINST	MOV	FILST+OFLEV,(PC)+,*
NWJBNM:	 .WORD	0
 OINST	MOV	FILST+OFLEV+2,-(SP),*
 OINST	MOV	FILST+OFLEV+12,(PC)+,*
NVAL:	 .WORD	0
 OINST	MOV	.USRBU,RELBUF,*
	JSR	PC,RDBUF
	MOV	R4,R5
.IF NE	MMG$T
 OINST	MOV	66(R4),$VLY,,*
	BEQ	1$
 OINST	MOV	64(R4),$VLY,,*
1$:
.ENDC
	MOV	R5,R3
	ADD	#RSZ,R3
	MOV	(R3)+,R4
.IF EQ	MMG$T
	MOV	JSW(R5),OVFLG
	BIC	#^C<OVLY$>,(PC)+
OVFLG:	 .WORD	0
.IFF
	MOV	JSW(R5),-(SP)
	MOV	@SP,OVFLG
	BIC	#^C<OVLY$>,(PC)+
OVFLG:	 .WORD	0
	BIT	#VIRT$,(SP)+
	BEQ	2$
	CLR	@R3
	ADD	#1000,R4
	CLR	NVFLG
2$:
.ENDC
	MOV	(R3)+,R0
	TST	(R3)+
	MOV	#FMPUR,R2
	MOV	STK(R5),-(SP)
	SUB	(PC)+,@SP
NVFLG:	 .WORD	1000
.IF EQ	MMG$T
	BNE	4$
.IFF
	BEQ	3$
	TST	NVFLG
	BEQ	4$
	ADD	R2,@SP
	BR	4$
3$:
.ENDC
	ADD	R0,R2
4$:	MOV	R2,-(SP)
	MOV	R2,R1
	SUB	NVFLG,R1
	MOV	R1,FBASE
	CMP	#<^RREL>,(R3)+
	BEQ	6$
.IF NE MMG$T
	TST	NVFLG
	BEQ	5$
.ENDC
	KMRTMG	<Illegal file format>,,PFILE
.IF NE	MMG$T
5$:	MOV	USERTOP(R5),R4
	ADD	#2,R4
	CLR	@R3
	CMP	#<^RVIR>,@R5
	BNE	6$
	CLR	NVAL
	MOV	VIRTOP(R5),(PC)+
VHGH:	 .WORD	0
.ENDC
6$:	MOV	@R3,RELBLK
	ADD	R4,R2
	ROR	R4
	MOV	R4,OVSIZ
	MOV	R2,-(SP)
	ADD	OVSZ(R5),R2
	MOV	NVAL,R0
	ADD	R2,R0
.IF NE	MMG$T
	TST	NVFLG
	BNE	7$
	MOV	#77,R3
	MOV	R0,R1
	SUB	#FMPUR,R1
	ADD	R3,R1
	BIC	R3,R1
	MOV	R1,(PC)+
PVSIZ:	 .WORD	0
	ADD	#177,R0
	BIC	R3,R0
	ADD	#100,@SP
7$:
.ENDC
	MOV	SP,@<.EXTFL-OVLY>-<.+4-OVLYST>(PC)
	OJSR	PC,GETBLK
	BCC	8$
	SUB	R0,R5
	SUB	R0,10(SP)
	SUB	R0,RELBUF
8$:
.IF NE	MMG$T
	MOV	R4,R0
	ADD	#FMPUR,R0
	ADD	#77,R0
	BIC	#77,R0
	MOV	R0,STOVL
	ADD	PVSIZ,R0
	MOV	R0,(PC)+
RHLIM:	 .WORD	0
.ENDC
	MOV	#FMPUR/2,R0
	MOV	R4,R1
9$:	CLR	(R1)+
	DEC	R0
	BNE	9$
	ADD	R4,FBASE
	ADD	R4,@SP
	MOV	(SP)+,(PC)+
FRJOOF:	 .WORD	0
	MOV	(SP)+,R0
	MOV	(SP)+,R1
	BNE	10$
	MOV	R0,R1
10$:
.IF EQ	MMG$T
	ADD	R4,R1
	MOV	R1,R3
.IFF
	TST	NVFLG
	BNE	11$
	BIS	#WINDW$,@R4
	SUB	#FMPUR,R2
	MOV	VHGH,I.VHI(R4)
	CLR	FBASE
	CLR	R0
	BR	12$
11$:	ADD	R4,R1
.ENDC
	ADD	R4,R2
	ADD	R4,R0
	MOV	R0,STOVL
	SUB	NVFLG,R0
12$:
	MOV	STOVL,-(SP)
	MOV	R1,-(SP)
13$:	MOV	R5,R1
.IF EQ	MMG$T
	ADD	#V.TRAP,R1
	CLR	-(R3)
	MOV	STA(R5),-(R3)
	ADD	R0,@R3
	SUB	#6*2,R3
.IFF
	ADD	#V.MMU,R1
	MOV	R4,R3
	ADD	#I.RSAV+4,R3
	MOV	STA(R5),-(R3)
	ADD	R0,@R3
	MOV	#CMODE,-(R3)
	MOV	#200,-(R3)
	JSR	PC,MOVVEC
	ADD	#V.BPT-<V.MMU+4>,R1
	JSR	PC,MOVVC2
	ADD	#V.TRAP-<V.IOT+4>,R1
	MOV	@SP,I.SP(R4)
	MOV	@SP,I.SPSV(R4)
.ENDC
	JSR	PC,MOVVC2
	MOV	(SP)+,@R3
	MOV	(R1)+,-(R3)
.IF NE	MTT$Y
	MOV	@R3,I.TERM(R4)
.ENDC
	JSR	PC,MOVVEC
	MOV	R2,@R3
	SUB	#2,@R3
	MOV	R2,-(SP)
	ADD	NVAL,@SP
	CLR	-(R3)
.IF NE	MTT$Y
	OADDR	FILST+OFTCB+2,R2
	MOV	@R2,R2
	MOV	T.TFIL(R2),-(R3)
.ENDC
.IF EQ	MMG$T
	MOV	R3,I.SP(R4)
.ENDC
.DSABL	LSB
.ENABL	LSB
	MOV	R4,(PC)+
STMPUR:	 .WORD	0
	ADDR	IMPINI,R1
1$:	MOV	(R1)+,R2
	ADD	R4,R2
	MOV	(R1)+,@R2
	ADD	R4,@R2
	TST	@R1
	BNE	1$
	MOV	NWJBNM,I.JNUM(R4)
	MOV	#FCHNM,I.CNUM(R4)
	ADD	#<CHOVLY*5*2>+IMPSIZ-I.CSW,R2
	MOV	R2,R0
	MOV	#$CSW+<CHOVLY*5*2>-$RMON,R1
	ADD	@#SYSPTR,R1
.REPT	CHNWDS
	MOV	(R1)+,(R2)+
.ENDR
	TST	OVFLG
	BNE	2$
	CLR	@R0
2$:	MOV	R2,-(SP)
.IF NE	MMG$T
	ADD	#I.WNUM-<IMPSIZ+<FCHNM*5*2>>,R2
	MOV	#W.NNUM,(R2)+
	TST	NVFLG
	BNE	4$
	CLR	@SP
	MOV	R4,R0
	ADD	#I.RGN,R0
	MOV	R0,(R2)+
	CLR	(R0)+
	MOV	RHLIM,R1
	ASHC	#-6,R1
	MOV	R1,(R0)+
	MOV	#400,@R0
	CLR	(R2)+
	MOV	PVSIZ,R1
	MOV	R1,(R2)+
	ASHC	#-6,R1
	MOV	R1,(R2)+
	MOV	R1,R0
	MOV	STOVL,R1
	ASHC	#-6,R1
	MOV	R1,(R2)+
	MOV	#200,(R2)+
3$:	INCB	-1(R2)
	SUB	#200,R0
	BGT	3$
	SWAB	R0
	CLRB	R0
	ADD	#77406,R0
	MOV	R0,@R2
4$:
 OINST	TST	$VLY,,*
	BEQ	6$
	OJSR	PC,$VRAW
	MOV	R4,R1
	ADD	#<I.RGN+R.BLGH>,R1
	MOV	@#SYSPTR,R0
	ADD	#BKGND+I.RGN+R.BLGH-$RMON,R0
	MOV	#3,R2
5$:	MOV	@R0,(R1)+
	CLR	(R0)+
	DEC	R2
	BNE	5$
6$:
.ENDC
 OINST	MOV	@.CNTXT,R1,*
.IF NE	SYT$K
	CMP	#FJOBNM,I.JNUM(R4)
	BNE	7$
.ENDC
	MOV	I.MSG(R1),I.MSG(R4)
7$:	MOV	#I.NAME,R2
	ADD	R2,R1
	ADD	R4,R2
.REPT	4
	MOV	(R1)+,(R2)+
.ENDR
.DSABL	LSB
.ENABL	LSB
	ADDR	OVBK,R0
	MOV	R0,-(SP)
.IF NE	MMG$T
	TST	NVFLG
	BEQ	1$
.ENDC
	INC	@R0
1$:	MOV	#10*400+CHOVLY,-(R0)
	EMT	375
	BCS	FRERR
RELSET:	MOV	(PC)+,R1
FBASE:	 .WORD	0
	MOV	STOVL,R4
.IF NE	MMG$T
	TST	NVFLG
	BNE	2$
	MOV	(PC)+,(R4)+
	 BIC	R0,R0
	MOV	(PC)+,(R4)+
	 .ASTX
	ADD	#1000-4,R4
	TST	RELBLK
	BEQ	6$
2$:
.ENDC
	MOV	R4,(PC)+
SAVLOD:	 .WORD	0
	CLR	R5
RLROOT:	MOV	SAVLOD,STOVL
	JSR	PC,RELSEG
	MOV	FRJOOF,STOVL
3$:	TST	FLG2
	BNE	6$
	JSR	PC,GET2WD
	MOV	@SP,R0
	MOV	R3,@R0
	MOV	R2,OVSIZ
	BEQ	RLROOT
	MOV	#10*400+CHOVLY,-(R0)
	EMT	375
	BCS	FRERR
	JSR	PC,RELSEG
	MOV	@SP,R0
	MOV	#11*400+CHOVLY,-(R0)
	EMT	375
	BCC	3$
	MOV	2(SP),R4
	BEQ	4$
	OJSR	PC,PUTBLK
4$:	KMRTMG	<Output error>,,PFILE
FRERR:	MOV	2(SP),R4
	BEQ	5$
	OJSR	PC,PUTBLK
5$:	OJMP	FIPERR
6$:	MOV	NWJBNM,@SP
	MOV	STMPUR,-(SP)
	OVLINK	STRTPG
.DSABL	LSB
.ENABL	LSB
1$:	SUB	R1,@R0
RELSEG:	JSR	PC,GET2WD
	BCS	2$
	MOV	R3,R0
	ASL	R0
	ADD	STOVL,R0
	MOV	R2,@R0
	ASL	R3
	BCS	1$
	ADD	R1,@R0
	BR	RELSEG
RDBUF:	ADDR	RLIOBK,R0
	EMT	375
	BCS	FRERR
	ADD	#2,RELBLK
	MOV	RELBUF,R4
	MOV	R4,R5
	ASL	R0
	ADD	R0,R5
2$:	RTS	PC
.DSABL	LSB
GET2WD:	JSR	PC,1$
	BCS	3$
	MOV	R2,R3
1$:	CMP	R4,R5
	BLO	2$
	JSR	PC,RDBUF
2$:	MOV	(R4)+,R2
	CMP	#-2,R2
	BNE	3$
	INC	FLG2
	SEC
3$:	RTS	PC
MOVVC2:	MOV	PC,-(SP)
MOVVEC:	MOV	(R1)+,-(R3)
	BEQ	10$
	ADD	R0,@R3
10$:	MOV	(R1)+,-(R3)
.IF NE	MMG$T
	BIS	#CMODE,@R3
.ENDC
	RTS	PC
IMPINI:	.WORD	I.QHDR,I.QUE
	.WORD	I.TID, I.JID
	.WORD	I.SCHP,I.SYCH
	.WORD	I.IRNG,I.ITOP+2
	.WORD	I.IPUT,I.ITOP+2
	.WORD	I.IGET,I.ITOP+2
	.WORD	I.ITOP,I.ITOP+2+TTYIN
	.WORD	I.OPUT,I.OTOP+2
	.WORD	I.OGET,I.OTOP+2
	.WORD	I.OTOP,I.OTOP+2+TTYOUT
.IF NE	MMG$T
.IF NE	FPU$11
	.WORD	I.FPSA,I.FSAV
.ENDC
	.WORD	I.WPTR,I.WNUM
.ENDC
	.WORD	I.CSW, IMPSIZ
	.WORD	0
RLIOBK:	.BYTE	CHOVLY,10
RELBLK:	.WORD	0
RELBUF:	.WORD	0,1000,0
OVIOBK:	.BYTE	CHOVLY,10
OVBK:	.WORD	0
STOVL:	.WORD	0
OVSIZ:	.WORD	0
	.WORD	0
FLG2:	.WORD	0
.ENDC
$$$EDIT	= 0
$$$FORT	= 1
$$$WILD	= 2
.IF NE	SET$$
OVERLAY
.SBTTL	SET
OVCMD	SET
.ENABL	LSB
	MOV	@#SYSPTR,R0
.IF EQ	MTT$Y
.IF NE	BF
	MOV	TTCNFG-$RMON(R0),SET58$
	MOVB	TTWIDTH-$RMON(R0),SET59$
.ENDC
.IFF
	MOV	BKCNSL-$RMON(R0),R4
	MOV	@R4,SET58$
	MOV	T.WID(R4),SET59$
.ENDC
.IF EQ	MMG$T
	MOV	CONFIG-$RMON(R0),R2
	BIC	#^C<USR$>,R2
	MOV	R2,SET62$
.ENDC
	JSR	PC,27$
	ADDR	SETMOF,R1
1$:	CMP	@R2,(R1)+
	BEQ	2$
	TST	@R1
	BEQ	4$
	ADD	@R1,R1
	BR	1$
2$:	JSR	PC,27$
	TST	(R1)+
	ADD	@R1,R0
3$:	TST	(R1)+
	TST	@R1
	BEQ	12$
	CMP	(R1)+,@R2
	BNE	3$
	MOVB	@R1,@R0
	RTS	PC
4$:	JSR	R4,30$
	 .WORD	':
	TST	2(R2)
	BEQ	5$
	JMP	24$
5$:	ADDR	SETTTY,R4
	CMP	@R2,#<^RTT >
	BEQ	6$
	ADD	#SETUSR-SETTTY,R4
	CMP	@R2,#<^RUSR>
	BEQ	6$
	MOV	@#SYSPTR,R0
	ADD	HSUFFX-$RMON(R0),@R2
	MOV	#<^RSY >,-(R2)
	MOV	#<^RSYS>,6(R2)
	MOV	#3*400+CHOVLY,R0
	EMT	374
	MOV	R2,R0
	OJSR	PC,COPYFN
	.LOOKUP	CHOVLY,R2
	BCS	21$
 OINST	MOV	.USRBUF,R4,*
	CLR	@<.BLKEY-OVLY>-<.+4-OVLYST>(PC)
	CLR	R0
	.READW	CHOVLY,R4,#512.
	BCS	23$
	ADD	#400,R4
6$:	MOVB	-(R5),R0
	SWAB	R0
	CLRB	R0
	BISB	-(R5),R0
	SUB	#"ON,R0
	BEQ	7$
	CMPB	(R5)+,(R5)+
	BR	8$
7$:	JSR	PC,29$
8$:	JSR	PC,27$
	MOV	R4,R1
	BR	11$
9$:	TST	(R1)+
10$:	CMP	(R1)+,-(R2)
11$:	MOV	(R1)+,R3
12$:	BEQ	24$
	CMP	(R2)+,(R1)+
	BNE	9$
	CMP	@R2,(R1)+
	BNE	10$
	MOV	R4,R2
	MOV	@R1,R1
	BMI	13$
	TST	R0
	BEQ	24$
13$:	TST	R0
	BNE	14$
	CMP	(R2)+,(R2)+
14$:	ASL	R1
	BPL	19$
	JSR	R4,30$
	 .WORD	'=
15$:	MOV	R5,R0
	DEC	R0
	ASL	R1
	SEC
	BPL	16$
	CLC
16$:	OJSR	PC,CVTNUM
	CMP	R5,R0
	BEQ	24$
	ASR	R1
	CMPB	@R5,#PERIOD
	BNE	18$
	BIT	#40000,R1
	BEQ	17$
	BIC	#40000,R1
	MOV	R0,R5
	INC	R5
	TST	(SP)+
	BR	15$
17$:	DEC	R5
18$:	MOV	(SP)+,R0
	JSR	PC,28$
19$:	BIC	#140000,R1
	ADD	R1,R2
	JSR	PC,@R2
	BCS	24$
	TSTB	-1(R5)
	BEQ	20$
	JSR	R4,30$
	 .WORD	',
	BR	6$
20$:
 OINST	CMP	.USRBUF,R4,*
	BHI	25$
 OINST	MOV	.USRBUF,R4,*
	CLR	R0
	.WRITW	CHOVLY,R4,#512.
	BCS	22$
	RTS	PC
21$:	OJMP	NOTFND
22$:	KMRTMG	<System outp