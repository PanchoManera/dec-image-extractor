ROL	R1
	ROL	R0
	CMP	R0,@R4
	BLO	2$
	SUB	@R4,R0
	INC	R2
2$:	DEC	R5
	BPL	1$
	TST	(R4)+
	RTS	R4
SDTM:	.BYTE	0,..SDTM
	.WORD	0
.NLIST	BEX
..MNTH	== .
MONTHS:	.ASCIZ	"-Jan-Feb-Mar-Apr-May-Jun-Jul-Aug-Sep-Oct-Nov-Dec-"
.LIST	BEX
	.BYTE	0,..GTIM
	.WORD	0
TMRLST:	.WORD	0,0
	.BYTE	24.,':,60.,':,60.,'.
CLKFRQ:	.BYTE	CLOCK,377,0
	.EVEN
.ENDC
.IF NE	CLOS$$
.SBTTL	CLOSE
CLOSEO:	TSTB	@R5
	BNE	12$
	CLR	R2
	CLR	R4
1$:	MOV	@#SYSPTR,R3
	ADD	#$CSW-$RMON,R3
	MOV	(PC)+,R5
	 .CLOSE	0
2$:	MOV	@R3,R0
	BPL	6$
	BIC	#^C<76>,R0
	ADD	@#SYSPTR,R0
	ADD	#$PNAME-$RMON,R0
 OINST	MOV	@R0,INPFN,,*
	TST	R2
	BNE	4$
	OADDR	DEVSTS,SP
	EMT	342
	BCS	11$
	TST	4(R0)
	BNE	3$
	MOV	2(R0),R0
	CMP	R0,R4
	BLOS	3$
	MOV	R0,R4
3$:	BR	6$
4$:	MOV	R0,-(SP)
	TST	R4
	BEQ	5$
	.SERR
	MOV	@SP,R0
	.FETCH	R4
	BCS	10$
	.HERR
5$:
.IF EQ	BF
	CLRB	C.DEVQ(R3)
.ENDC
	MOV	R5,@PC
	 HALT
	BCS	13$
	MOV	(SP)+,R0
	.RELEASE
6$:	INC	R5
	ADD	#12,R3
	CMP	R5,(PC)+
	 .CLOSE	20
	BLO	2$
	TST	R2
	BNE	8$
	MOV	R4,R0
	BEQ	7$
 OINST	MOV	SP,@.EXTFL,,*
	OJSR	PC,GETBLK
	BCC	7$
	SUB	R0,@SP
7$:
 OINST	CLR	@.EXTFL,,*
	MOV	SP,R2
	BR	1$
8$:	TST	R4
	BEQ	9$
 OINST	MOV	SP,@.EXTFL,,*
	OJSR	PC,PUTBLK
	BCC	9$
	ADD	R0,@SP
9$:
 OINST	CLR	@.EXTFL,,*
.IF NE	BF
	.SRESET
.IFF
	OJSR	PC,RSTSRS
.ENDC
	RTS	PC
10$:	OJSR	PC,PUTBLK
	TSTB	@#ERRBYT
	BPL	11$
	OJMP	BADFET
11$:	OJMP	BADHAN
12$:	OJMP	BADCOM
13$:	KMEROR	<File created:protected file already exists>,,WARN$
.ENDC
.IF NE	HELP$$
HELP1:	MOV	#600,R0
	INC	R5
1$:	MOVB	-(R5),(R0)+
	BNE	1$
	CLRB	@#512
	CLRB	@#540
	MOV	#500,R0
	ADDR	HLPBLK,R1
	MOV	(R1)+,(R0)+
	MOV	(R1)+,(R0)+
	MOV	(R1)+,(R0)+
	MOV	(R1)+,(R0)+
.IF NE	BF
	.SRESET
.IF NE	MMG$T
	BIC	#VIRT$,@#JSW
.ENDC
.IFF
	OJSR	PC,RSTSRS
.ENDC
	.CHAIN
..HELF	== .
HLPBLK:	.RAD50	"SY HELP  SAV"
.ENDC
.SBTTL	SCAN LINE FOR @FILE (CONTINUED)
AT2A:	MOV	R5,-(SP)
	INC	@SP
1$:	CMPB	-(R5),#SPACE
	BEQ	1$
	INC	R5
 OINST	BIT	#IFACTV,@.STATWD,,*
	BEQ	2$
	OJSR	PC,SVST
	CMP	-(R2),-(R2)
	CMPB	-(R2),-(R2)
	BEQ	4$
	MOV	@R2,-(SP)
	ADD	#IFSVSZ,R2
	MOV	(SP)+,@R2
	INC	(R2)+
	CLR	(R2)+
	CLR	(R2)+
 OINST	MOV	R2,@.IFSVST,,*
..ATDK	== .+2
2$:	MOV	#<^RDK >,R3
	OJSR	PC,IFILE
	INC	R5
3$:	CMPB	-(R5),#SPACE
	BEQ	3$
	TSTB	@R5
	BNE	CMDEOL
 OINST	MOV	ACCUM,-(SP),*
	OJMP	AT3
4$:	KMEROR	<Command file nesting too deep>
CMDEOL:	KMEROR	<Command file not at end of line>
.SBTTL	LOAD
OVERLAY
.IF NE	UNLO$$
	SYNTAX	UNLOAD
	PROMPT	$DEVICE
	REQBLNK
	END
 SWITS	UNLOAD
 ENDNO
 NOS
 ENDS
	OVCMD	UNLOAD
	ITB